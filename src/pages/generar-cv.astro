---
import '../styles/global.css'; // Mantenemos los estilos base (colores crema/negro del portfolio, pero los sobrescribiremos con estilos espec√≠ficos para esta p√°gina)
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generador de CV profesional | Aar√≥n Garc√≠a S√°nchez</title>
    <!-- Fuentes profesionales -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Estilos espec√≠ficos para esta p√°gina (sobrescriben los globales) -->
    <style>
      /* Variables de color propias de esta p√°gina */
      :root {
        --primary-dark: #1E3A8A;
        --primary: #3B82F6;
        --primary-light: #93C5FD;
        --background: #F9FAFB;
        --card-bg: #FFFFFF;
        --text-dark: #1F2937;
        --text-light: #6B7280;
        --border: #E5E7EB;
      }

      /* Reset para esta p√°gina (anula los estilos globales del portfolio) */
      body {
        background-color: var(--background);
        color: var(--text-dark);
        font-family: 'Open Sans', sans-serif;
      }

      h1, h2, h3, h4, .font-serif {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        color: var(--primary-dark);
      }

      /* Header simplificado (solo enlace a inicio) */
      .cv-header {
        background-color: white;
        border-bottom: 1px solid var(--border);
        box-shadow: 0 2px 4px rgba(0,0,0,0.02);
      }
      .cv-header a {
        color: var(--primary-dark);
        font-weight: 600;
        font-family: 'Montserrat', sans-serif;
      }

      /* Tarjetas de secci√≥n */
      .cv-card {
        background: var(--card-bg);
        border: none;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .cv-card h2 {
        font-size: 1.5rem;
        margin-top: 0;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--primary-light);
        display: inline-block;
      }

      /* Inputs y textareas */
      .cv-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        border-radius: 0.5rem;
        font-family: 'Open Sans', sans-serif;
        font-size: 0.95rem;
        transition: border-color 0.2s, box-shadow 0.2s;
        background-color: white;
      }
      .cv-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      .cv-input::placeholder {
        color: var(--text-light);
        opacity: 0.6;
      }

      /* Etiquetas */
      .cv-label {
        display: block;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-dark);
        font-family: 'Montserrat', sans-serif;
      }
      .cv-label small {
        font-weight: 400;
        color: var(--text-light);
        font-size: 0.85rem;
      }

      /* Botones */
      .cv-btn-primary {
        background-color: var(--primary-dark);
        color: white;
        border: none;
        padding: 0.9rem 2.5rem;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 1.1rem;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .cv-btn-primary:hover {
        background-color: #2563EB;
        transform: translateY(-1px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
      }
      .cv-btn-primary:active {
        transform: translateY(0);
      }

      /* Badge para separador | */
      .badge-pipe {
        background-color: var(--primary-light);
        color: var(--primary-dark);
        font-family: monospace;
        padding: 0.2rem 0.6rem;
        border-radius: 0.375rem;
        font-size: 0.85rem;
      }

      /* Mensaje de estado */
      .status-message {
        margin-top: 2rem;
        padding: 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        text-align: center;
      }

      /* Footer */
      .cv-footer {
        border-top: 1px solid var(--border);
        color: var(--text-light);
        font-size: 0.9rem;
        padding: 2rem 0;
        margin-top: 3rem;
        text-align: center;
      }

      /* Detalles (secci√≥n plegable) */
      details.cv-card summary {
        font-size: 1.5rem;
        font-weight: 700;
        font-family: 'Montserrat', sans-serif;
        color: var(--primary-dark);
        cursor: pointer;
        list-style: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      details.cv-card summary::-webkit-details-marker {
        display: none;
      }
      details.cv-card summary::before {
        content: '‚ñ∂';
        font-size: 1.2rem;
        color: var(--primary);
        transition: transform 0.2s;
      }
      details[open].cv-card summary::before {
        transform: rotate(90deg);
      }

      /* Grid de radios */
      .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-top: 0.5rem;
      }
      .radio-group label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        font-weight: 500;
      }
      .radio-group input[type="radio"] {
        accent-color: var(--primary-dark);
        width: 1.1rem;
        height: 1.1rem;
      }
    </style>
  </head>
  <body>
    <!-- Header simplificado -->
    <header class="cv-header py-4">
      <nav class="container mx-auto px-6 flex justify-between items-center">
        <a href="/" class="text-2xl font-bold tracking-tight hover:opacity-80 transition">Inicio</a>
      </nav>
    </header>

    <main class="container mx-auto px-4 py-12 max-w-4xl">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">Genera tu CV profesional</h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Rellena el formulario con tus datos, elige una plantilla y obt√©n un PDF listo para enviar a empresas.
        </p>
      </div>

      <form id="cv-form" class="space-y-6">
        <!-- Datos personales -->
        <section class="cv-card">
          <h2>üìã Datos personales</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="cv-label">Nombre completo *</label>
              <input type="text" name="nombre" required class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Email *</label>
              <input type="email" name="email" required class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Tel√©fono</label>
              <input type="text" name="telefono" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Direcci√≥n</label>
              <input type="text" name="direccion" class="cv-input" />
            </div>
            <div class="md:col-span-2">
              <label class="cv-label">Perfil profesional</label>
              <textarea name="perfil" rows="3" class="cv-input"></textarea>
            </div>
          </div>
        </section>

        <!-- Educaci√≥n -->
        <section class="cv-card">
          <h2>üéì Educaci√≥n</h2>
          <p class="text-sm text-gray-500 mb-4">
            Para m√∫ltiples estudios, separa los valores con <span class="badge-pipe">|</span> (ej: M√°ster|Grado)
          </p>
          <div class="space-y-4">
            <div>
              <label class="cv-label">T√≠tulos</label>
              <input type="text" name="educacion_titulos" placeholder="M√°ster en Ciberseguridad|Grado en Inform√°tica" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Instituciones</label>
              <input type="text" name="educacion_instituciones" placeholder="Universidad de M√°laga|Universidad de M√°laga" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Fechas</label>
              <input type="text" name="educacion_fechas" placeholder="2024-2026|2020-2024" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Descripciones <small>(opcional)</small></label>
              <input type="text" name="educacion_descripciones" placeholder="Especializaci√≥n en forense|..." class="cv-input" />
            </div>
          </div>
        </section>

        <!-- Experiencia -->
        <section class="cv-card">
          <h2>üíº Experiencia</h2>
          <p class="text-sm text-gray-500 mb-4">
            Separa los valores con <span class="badge-pipe">|</span>
          </p>
          <div class="space-y-4">
            <div>
              <label class="cv-label">Puestos</label>
              <input type="text" name="experiencia_puestos" placeholder="Desarrollador|Asistente" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Empresas</label>
              <input type="text" name="experiencia_empresas" placeholder="Tech Solutions|InfoSys" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Fechas</label>
              <input type="text" name="experiencia_fechas" placeholder="2023-2024|2022-2023" class="cv-input" />
            </div>
            <div>
              <label class="cv-label">Descripciones</label>
              <input type="text" name="experiencia_descripciones" placeholder="Desarrollo backend|Soporte t√©cnico" class="cv-input" />
            </div>
          </div>
        </section>

        <!-- Habilidades e Idiomas -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <section class="cv-card">
            <h2>‚öôÔ∏è Habilidades</h2>
            <div class="space-y-4">
              <div>
                <label class="cv-label">T√©cnicas</label>
                <input type="text" name="habilidades_hard" placeholder="Python|JavaScript|Symfony" class="cv-input" />
              </div>
              <div>
                <label class="cv-label">Blandas</label>
                <input type="text" name="habilidades_soft" placeholder="Trabajo en equipo|Comunicaci√≥n" class="cv-input" />
              </div>
            </div>
          </section>

          <section class="cv-card">
            <h2>üåç Idiomas</h2>
            <div class="space-y-4">
              <div>
                <label class="cv-label">Idiomas</label>
                <input type="text" name="idiomas_nombres" placeholder="Espa√±ol|Ingl√©s" class="cv-input" />
              </div>
              <div>
                <label class="cv-label">Niveles</label>
                <input type="text" name="idiomas_niveles" placeholder="Nativo|B2" class="cv-input" />
              </div>
            </div>
          </section>
        </div>

        <!-- Certificaciones y proyectos (opcional) -->
        <details class="cv-card">
          <summary>Certificaciones y proyectos</summary>
          <div class="mt-4 space-y-6">
            <div>
              <h3 class="font-semibold text-lg mb-2">Certificaciones</h3>
              <div class="space-y-2">
                <input type="text" name="certificaciones_nombres" placeholder="Nombres (|)" class="cv-input" />
                <input type="text" name="certificaciones_entidades" placeholder="Entidades (|)" class="cv-input" />
                <input type="text" name="certificaciones_fechas" placeholder="Fechas (|)" class="cv-input" />
              </div>
            </div>
            <div>
              <h3 class="font-semibold text-lg mb-2">Proyectos</h3>
              <div class="space-y-2">
                <input type="text" name="proyectos_nombres" placeholder="Nombres (|)" class="cv-input" />
                <input type="text" name="proyectos_descripciones" placeholder="Descripciones (|)" class="cv-input" />
              </div>
            </div>
          </div>
        </details>

        <!-- Plantilla -->
       <!-- Plantilla -->
<section class="cv-card">
  <h2>üé® Elige una plantilla</h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
    <label class="block cursor-pointer border-2 rounded-xl p-4 transition-all hover:border-blue-500 has-[:checked]:border-blue-600 has-[:checked]:bg-blue-50">
      <input type="radio" name="plantilla" value="modern" class="hidden" checked />
      <img src="/thumbnails/modern-thumb.png" alt="Plantilla moderna" class="w-full rounded-lg mb-2" />
      <span class="block text-center font-semibold">Moderna</span>
      <span class="block text-center text-sm text-gray-600">Dise√±o limpio y profesional</span>
    </label>

    <label class="block cursor-pointer border-2 rounded-xl p-4 transition-all hover:border-blue-500 has-[:checked]:border-blue-600 has-[:checked]:bg-blue-50">
      <input type="radio" name="plantilla" value="classic" class="hidden" />
      <img src="/thumbnails/classic-thumb.png" alt="Plantilla cl√°sica" class="w-full rounded-lg mb-2" />
      <span class="block text-center font-semibold">Cl√°sica</span>
      <span class="block text-center text-sm text-gray-600">Elegante y atemporal</span>
    </label>

    <label class="block cursor-pointer border-2 rounded-xl p-4 transition-all hover:border-blue-500 has-[:checked]:border-blue-600 has-[:checked]:bg-blue-50">
      <input type="radio" name="plantilla" value="creative" class="hidden" />
      <img src="/thumbnails/creative-thumb.png" alt="Plantilla creativa" class="w-full rounded-lg mb-2" />
      <span class="block text-center font-semibold">Creativa</span>
      <span class="block text-center text-sm text-gray-600">Original y con personalidad</span>
    </label>
  </div>
</section>

        <!-- Bot√≥n de env√≠o -->
        <div class="text-center">
          <button type="submit" class="cv-btn-primary">
            Generar CV y descargar
          </button>
        </div>
      </form>

      <!-- Mensaje de estado -->
      <div id="status" class="status-message"></div>
    </main>

    <footer class="cv-footer">
      <p>¬© {new Date().getFullYear()} Aar√≥n Garc√≠a S√°nchez ¬∑ Generador de CV profesional</p>
    </footer>

    <script>
      // Manejo del env√≠o del formulario (sin cambios, igual que antes)
      const form = document.getElementById("cv-form");
      if (form && form instanceof HTMLFormElement) {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          console.log("Formulario enviado");
          const formData = new FormData(form);
          const statusDiv = document.getElementById("status");

          if (statusDiv) {
            statusDiv.innerHTML = "‚è≥ Generando CV, por favor espera...";
            statusDiv.style.backgroundColor = "#EFF6FF";
            statusDiv.style.color = "#1E3A8A";
          }

          try {
            const response = await fetch(
              "https://curriculum-bot-11qz.onrender.com",
              {
                method: "POST",
                body: formData,
              }
            );

            if (!response.ok) {
              let errorMsg = "Error al generar el CV";
              try {
                const errorData = await response.json();
                if (errorData.detail) errorMsg = errorData.detail;
              } catch {
                errorMsg = await response.text();
              }
              throw new Error(errorMsg);
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `cv_${formData.get("plantilla") || "modern"}.pdf`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);

            if (statusDiv) {
              statusDiv.innerHTML = "‚úÖ CV generado correctamente. La descarga deber√≠a comenzar.";
              statusDiv.style.backgroundColor = "#ECFDF3";
              statusDiv.style.color = "#065F46";
            }
          } catch (error) {
            let mensaje = "Error desconocido";
            if (error instanceof Error) {
              mensaje = error.message;
            } else if (typeof error === "string") {
              mensaje = error;
            }
            if (statusDiv) {
              statusDiv.innerHTML = `‚ùå Error: ${mensaje}`;
              statusDiv.style.backgroundColor = "#FEF2F2";
              statusDiv.style.color = "#991B1B";
            }
            console.error(error);
          }
        });
      }
    </script>
  </body>
</html>